[tox]
min_version = 4.0
env_list =
    py312
    py311
    py310
    py39
    py38
    typing
    format
    lint
    bandit

[testenv]
allowlist_externals = poetry, pytest
; Poetry is really bad in identifying running virtualenvs, so we can't use
; directly poetry install. This is the best hacky way to install poetry
; requirements inside tox.
commands_pre =
    poetry export -f requirements.txt --output /tmp/requirements.txt --with dev
    pip install -Uqr /tmp/requirements.txt
commands =
    pytest

[testenv:py312]
; Run with coverage in one python version to check coverage percentage
commands =
    pytest --cov

[testenv:typing]
allowlist_externals = poetry, mypy
; commands_pre is inherited from testenv
commands =
    mypy

[testenv:format]
allowlist_externals = poetry, black
; commands_pre is inherited from testenv
commands =
    black --check .

[testenv:lint]
allowlist_externals = poetry, ruff
; commands_pre is inherited from testenv
commands =
    ruff .

[testenv:bandit]
allowlist_externals = poetry, bandit
; commands_pre is inherited from testenv
commands =
    bandit -c .bandit.yml -r .
